<?xml version="1.0" ?>
<!-- This test case tests the usage management functionality of
KMIP. A key is created and the Activation Date and Protect Stop Date attributes
are set in such a way as to allow the Get Usage Allocation operation to be
performed. The value of the Usage Limits attribute is set to 1000 bytes, and
two subsequent requests for 500 bytes succeed (one of them also verifying the
amount that can be received using the Check operation), while a third fails
since the usage allocation has been used up. The key is finally revoked and
destroyed. This test case shows the use of multiple clients (Client-A, Client-B
and Client-C). -->
<KMIP>
# TIME 0
# [Client-A]
	<RequestMessage>
		<RequestHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<BatchCount type="Integer" value="1"/>
		</RequestHeader>
		<BatchItem>
			<Operation type="Enumeration" value="Create"/>
			<RequestPayload>
				<ObjectType type="Enumeration" value="SymmetricKey"/>
				<TemplateAttribute>
					<Attribute>
						<AttributeName type="TextString" value="Cryptographic Algorithm"/>
						<AttributeValue type="Enumeration" value="AES"/>
					</Attribute>
					<Attribute>
						<AttributeName type="TextString" value="Cryptographic Length"/>
						<AttributeValue type="Integer" value="128"/>
					</Attribute>
					<Attribute>
						<AttributeName type="TextString" value="Name"/>
						<AttributeValue>
							<NameValue type="TextString" value="Key1"/>
							<NameType type="Enumeration" value="UninterpretedTextString"/>
						</AttributeValue>
					</Attribute>
					<Attribute>
						<AttributeName type="TextString" value="Cryptographic Usage Mask"/>
						<AttributeValue type="Integer" value="Encrypt"/>
					</Attribute>
				</TemplateAttribute>
			</RequestPayload>
		</BatchItem>
	</RequestMessage>
	<ResponseMessage>
		<ResponseHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<TimeStamp type="DateTime" value="2010-03-11T12:21:46+00:00"/>
			<BatchCount type="Integer" value="1"/>
		</ResponseHeader>
		<BatchItem>
			<Operation type="Enumeration" value="Create"/>
			<ResultStatus type="Enumeration" value="Success"/>
			<ResponsePayload>
				<ObjectType type="Enumeration" value="SymmetricKey"/>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
			</ResponsePayload>
		</BatchItem>
	</ResponseMessage>
# TIME 1
# [Client-A]
	<RequestMessage>
		<RequestHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<BatchCount type="Integer" value="2"/>
		</RequestHeader>
		<BatchItem>
			<Operation type="Enumeration" value="AddAttribute"/>
			<UniqueBatchItemID type="ByteString" value="d7fe2477e364ae1a"/>
			<RequestPayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
				<Attribute>
					<AttributeName type="TextString" value="Activation Date"/>
					<AttributeValue type="DateTime" value="$NOW-3600"/>
				</Attribute>
			</RequestPayload>
		</BatchItem>
		<BatchItem>
			<Operation type="Enumeration" value="AddAttribute"/>
			<UniqueBatchItemID type="ByteString" value="9696012991bc8a59"/>
			<RequestPayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
				<Attribute>
					<AttributeName type="TextString" value="Protect Stop Date"/>
					<AttributeValue type="DateTime" value="$NOW+600"/>
				</Attribute>
			</RequestPayload>
		</BatchItem>
	</RequestMessage>
	<ResponseMessage>
		<ResponseHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<TimeStamp type="DateTime" value="2010-03-11T12:21:47+00:00"/>
			<BatchCount type="Integer" value="2"/>
		</ResponseHeader>
		<BatchItem>
			<Operation type="Enumeration" value="AddAttribute"/>
			<UniqueBatchItemID type="ByteString" value="d7fe2477e364ae1a"/>
			<ResultStatus type="Enumeration" value="Success"/>
			<ResponsePayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
				<Attribute>
					<AttributeName type="TextString" value="Activation Date"/>
					<AttributeValue type="DateTime" value="$NOW-3600"/>
				</Attribute>
			</ResponsePayload>
		</BatchItem>
		<BatchItem>
			<Operation type="Enumeration" value="AddAttribute"/>
			<UniqueBatchItemID type="ByteString" value="9696012991bc8a59"/>
			<ResultStatus type="Enumeration" value="Success"/>
			<ResponsePayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
				<Attribute>
					<AttributeName type="TextString" value="Protect Stop Date"/>
					<AttributeValue type="DateTime" value="$NOW+600"/>
				</Attribute>
			</ResponsePayload>
		</BatchItem>
	</ResponseMessage>
# TIME 2
# [Client-A]
	<RequestMessage>
		<RequestHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<BatchCount type="Integer" value="1"/>
		</RequestHeader>
		<BatchItem>
			<Operation type="Enumeration" value="AddAttribute"/>
			<RequestPayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
				<Attribute>
					<AttributeName type="TextString" value="Usage Limits"/>
					<AttributeValue>
						<UsageLimitsTotal type="LongInteger" value="1000"/>
						<UsageLimitsUnit type="Enumeration" value="Byte"/>
					</AttributeValue>
				</Attribute>
			</RequestPayload>
		</BatchItem>
	</RequestMessage>
	<ResponseMessage>
		<ResponseHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<TimeStamp type="DateTime" value="2010-03-11T12:21:48+00:00"/>
			<BatchCount type="Integer" value="1"/>
		</ResponseHeader>
		<BatchItem>
			<Operation type="Enumeration" value="AddAttribute"/>
			<ResultStatus type="Enumeration" value="Success"/>
			<ResponsePayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
				<Attribute>
					<AttributeName type="TextString" value="Usage Limits"/>
					<AttributeValue>
						<UsageLimitsTotal type="LongInteger" value="1000"/>
						<UsageLimitsCount type="LongInteger" value="1000"/>
						<UsageLimitsUnit type="Enumeration" value="Byte"/>
					</AttributeValue>
				</Attribute>
			</ResponsePayload>
		</BatchItem>
	</ResponseMessage>
# TIME 3
# [Client-B]
	<RequestMessage>
		<RequestHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<BatchCount type="Integer" value="1"/>
		</RequestHeader>
		<BatchItem>
			<Operation type="Enumeration" value="Locate"/>
			<RequestPayload>
				<Attribute>
					<AttributeName type="TextString" value="Object Type"/>
					<AttributeValue type="Enumeration" value="SymmetricKey"/>
				</Attribute>
				<Attribute>
					<AttributeName type="TextString" value="Name"/>
					<AttributeValue>
						<NameValue type="TextString" value="Key1"/>
						<NameType type="Enumeration" value="UninterpretedTextString"/>
					</AttributeValue>
				</Attribute>
			</RequestPayload>
		</BatchItem>
	</RequestMessage>
	<ResponseMessage>
		<ResponseHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<TimeStamp type="DateTime" value="2010-03-11T12:21:48+00:00"/>
			<BatchCount type="Integer" value="1"/>
		</ResponseHeader>
		<BatchItem>
			<Operation type="Enumeration" value="Locate"/>
			<ResultStatus type="Enumeration" value="Success"/>
			<ResponsePayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
			</ResponsePayload>
		</BatchItem>
	</ResponseMessage>
# TIME 4
# [Client-B]
	<RequestMessage>
		<RequestHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<BatchCount type="Integer" value="1"/>
		</RequestHeader>
		<BatchItem>
			<Operation type="Enumeration" value="Get"/>
			<RequestPayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
			</RequestPayload>
		</BatchItem>
	</RequestMessage>
	<ResponseMessage>
		<ResponseHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<TimeStamp type="DateTime" value="2010-03-11T12:21:48+00:00"/>
			<BatchCount type="Integer" value="1"/>
		</ResponseHeader>
		<BatchItem>
			<Operation type="Enumeration" value="Get"/>
			<ResultStatus type="Enumeration" value="Success"/>
			<ResponsePayload>
				<ObjectType type="Enumeration" value="SymmetricKey"/>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
				<SymmetricKey>
					<KeyBlock>
						<KeyFormatType type="Enumeration" value="Raw"/>
						<KeyValue>
							<KeyMaterial type="ByteString" value="674b32b1a3266df1253b0f2c4440b0b0"/>
						</KeyValue>
						<CryptographicAlgorithm type="Enumeration" value="AES"/>
						<CryptographicLength type="Integer" value="128"/>
					</KeyBlock>
				</SymmetricKey>
			</ResponsePayload>
		</BatchItem>
	</ResponseMessage>
# TIME 5
# [Client-B]
	<RequestMessage>
		<RequestHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<BatchOrderOption type="Boolean" value="true"/>
			<BatchCount type="Integer" value="2"/>
		</RequestHeader>
		<BatchItem>
			<Operation type="Enumeration" value="Check"/>
			<UniqueBatchItemID type="ByteString" value="19d4f3dc9635307a"/>
			<RequestPayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
				<UsageLimitsCount type="LongInteger" value="500"/>
			</RequestPayload>
		</BatchItem>
		<BatchItem>
			<Operation type="Enumeration" value="GetUsageAllocation"/>
			<UniqueBatchItemID type="ByteString" value="20c8dffd55bdeee8"/>
			<RequestPayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
				<UsageLimitsCount type="LongInteger" value="500"/>
			</RequestPayload>
		</BatchItem>
	</RequestMessage>
	<ResponseMessage>
		<ResponseHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<TimeStamp type="DateTime" value="2010-03-11T12:21:49+00:00"/>
			<BatchCount type="Integer" value="2"/>
		</ResponseHeader>
		<BatchItem>
			<Operation type="Enumeration" value="Check"/>
			<UniqueBatchItemID type="ByteString" value="19d4f3dc9635307a"/>
			<ResultStatus type="Enumeration" value="Success"/>
			<ResponsePayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
			</ResponsePayload>
		</BatchItem>
		<BatchItem>
			<Operation type="Enumeration" value="GetUsageAllocation"/>
			<UniqueBatchItemID type="ByteString" value="20c8dffd55bdeee8"/>
			<ResultStatus type="Enumeration" value="Success"/>
			<ResponsePayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
			</ResponsePayload>
		</BatchItem>
	</ResponseMessage>
# TIME 6
# [Client-A]
	<RequestMessage>
		<RequestHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<BatchCount type="Integer" value="1"/>
		</RequestHeader>
		<BatchItem>
			<Operation type="Enumeration" value="GetUsageAllocation"/>
			<RequestPayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
				<UsageLimitsCount type="LongInteger" value="500"/>
			</RequestPayload>
		</BatchItem>
	</RequestMessage>
	<ResponseMessage>
		<ResponseHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<TimeStamp type="DateTime" value="2010-03-11T12:21:49+00:00"/>
			<BatchCount type="Integer" value="1"/>
		</ResponseHeader>
		<BatchItem>
			<Operation type="Enumeration" value="GetUsageAllocation"/>
			<ResultStatus type="Enumeration" value="Success"/>
			<ResponsePayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
			</ResponsePayload>
		</BatchItem>
	</ResponseMessage>
# TIME 7
# [Client-C]
	<RequestMessage>
		<RequestHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<BatchCount type="Integer" value="1"/>
		</RequestHeader>
		<BatchItem>
			<Operation type="Enumeration" value="Locate"/>
			<RequestPayload>
				<Attribute>
					<AttributeName type="TextString" value="Object Type"/>
					<AttributeValue type="Enumeration" value="SymmetricKey"/>
				</Attribute>
				<Attribute>
					<AttributeName type="TextString" value="Name"/>
					<AttributeValue>
						<NameValue type="TextString" value="Key1"/>
						<NameType type="Enumeration" value="UninterpretedTextString"/>
					</AttributeValue>
				</Attribute>
			</RequestPayload>
		</BatchItem>
	</RequestMessage>
	<ResponseMessage>
		<ResponseHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<TimeStamp type="DateTime" value="2010-03-11T12:21:49+00:00"/>
			<BatchCount type="Integer" value="1"/>
		</ResponseHeader>
		<BatchItem>
			<Operation type="Enumeration" value="Locate"/>
			<ResultStatus type="Enumeration" value="Success"/>
			<ResponsePayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
			</ResponsePayload>
		</BatchItem>
	</ResponseMessage>
# TIME 8
# [Client-C]
	<RequestMessage>
		<RequestHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<BatchCount type="Integer" value="1"/>
		</RequestHeader>
		<BatchItem>
			<Operation type="Enumeration" value="Get"/>
			<RequestPayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
			</RequestPayload>
		</BatchItem>
	</RequestMessage>
	<ResponseMessage>
		<ResponseHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<TimeStamp type="DateTime" value="2010-03-11T12:21:49+00:00"/>
			<BatchCount type="Integer" value="1"/>
		</ResponseHeader>
		<BatchItem>
			<Operation type="Enumeration" value="Get"/>
			<ResultStatus type="Enumeration" value="Success"/>
			<ResponsePayload>
				<ObjectType type="Enumeration" value="SymmetricKey"/>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
				<SymmetricKey>
					<KeyBlock>
						<KeyFormatType type="Enumeration" value="Raw"/>
						<KeyValue>
							<KeyMaterial type="ByteString" value="674b32b1a3266df1253b0f2c4440b0b0"/>
						</KeyValue>
						<CryptographicAlgorithm type="Enumeration" value="AES"/>
						<CryptographicLength type="Integer" value="128"/>
					</KeyBlock>
				</SymmetricKey>
			</ResponsePayload>
		</BatchItem>
	</ResponseMessage>
# TIME 9
# [Client-C]
	<RequestMessage>
		<RequestHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<BatchCount type="Integer" value="1"/>
		</RequestHeader>
		<BatchItem>
			<Operation type="Enumeration" value="GetUsageAllocation"/>
			<RequestPayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
				<UsageLimitsCount type="LongInteger" value="500"/>
			</RequestPayload>
		</BatchItem>
	</RequestMessage>
	<ResponseMessage>
		<ResponseHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<TimeStamp type="DateTime" value="2010-03-11T12:21:49+00:00"/>
			<BatchCount type="Integer" value="1"/>
		</ResponseHeader>
		<BatchItem>
			<Operation type="Enumeration" value="GetUsageAllocation"/>
			<ResultStatus type="Enumeration" value="OperationFailed"/>
			<ResultReason type="Enumeration" value="PermissionDenied"/>
			<ResultMessage type="TextString" value="Unable   to allocate requested amount"/>
		</BatchItem>
	</ResponseMessage>
# TIME 10
# [Client-A]
	<RequestMessage>
		<RequestHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<BatchOrderOption type="Boolean" value="true"/>
			<BatchCount type="Integer" value="2"/>
		</RequestHeader>
		<BatchItem>
			<Operation type="Enumeration" value="Revoke"/>
			<UniqueBatchItemID type="ByteString" value="727a212bc674b4ea"/>
			<RequestPayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
				<RevocationReason>
					<RevocationReasonCode type="Enumeration" value="CessationOfOperation"/>
				</RevocationReason>
			</RequestPayload>
		</BatchItem>
		<BatchItem>
			<Operation type="Enumeration" value="Destroy"/>
			<UniqueBatchItemID type="ByteString" value="1d0ebf826109b0a5"/>
			<RequestPayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
			</RequestPayload>
		</BatchItem>
	</RequestMessage>
	<ResponseMessage>
		<ResponseHeader>
			<ProtocolVersion>
				<ProtocolVersionMajor type="Integer" value="1"/>
				<ProtocolVersionMinor type="Integer" value="0"/>
			</ProtocolVersion>
			<TimeStamp type="DateTime" value="2010-03-11T12:21:51+00:00"/>
			<BatchCount type="Integer" value="2"/>
		</ResponseHeader>
		<BatchItem>
			<Operation type="Enumeration" value="Revoke"/>
			<UniqueBatchItemID type="ByteString" value="727a212bc674b4ea"/>
			<ResultStatus type="Enumeration" value="Success"/>
			<ResponsePayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
			</ResponsePayload>
		</BatchItem>
		<BatchItem>
			<Operation type="Enumeration" value="Destroy"/>
			<UniqueBatchItemID type="ByteString" value="1d0ebf826109b0a5"/>
			<ResultStatus type="Enumeration" value="Success"/>
			<ResponsePayload>
				<UniqueIdentifier type="TextString" value="$UNIQUE_IDENTIFIER_0"/>
			</ResponsePayload>
		</BatchItem>
	</ResponseMessage>
</KMIP>